# ☸️ Multi-Node K3s Cluster with Vagrant + Ansible

This is the **advanced version of `p1`**, where we ditch manual shell scripts and embrace the power of **Ansible** for provisioning a multi-node cluster — because automation is fun 😎

---

## 🧠 What's New Compared to `p1`?

| Feature             | `p1` (Manual Scripts)  | `p2` (Ansible Version)       |
|---------------------|------------------------|------------------------------|
| K3s Installation    | Manually run shell     | Fully automated with Ansible |
| Shared `.env` Token | ✔️                     | ✔️                           |
| Script Reuse        | ❌ Copy/paste scripts  | ✔️ Modular Ansible roles     |
| Task Visibility     | ❌                     | ✔️ Inventory + output        |
| Automation Level    | Low                    | High 🚀                      |

---

## 📁 Project Structure

```txt
.
├── ansible
│	├── ansible.cfg
│	├── inventory.ini          # SSH connection details (auto-generated by Vagrant)
│	├── playbook.yml           # Main playbook coordinating tasks
│	└── roles
│	    ├── common             # Shared tasks for all nodes
│	    │	 └── tasks
│	    │	     └── main.yml
│	    ├── k3s_agent          # Tasks specific to K3s agents
│	    │	 └── tasks
│	    │	     └── main.yml
│	    └── k3s_server         # Tasks specific to K3s server
│	        └── tasks
│	            └── main.yml
├── boxes.json
├── .env.example
├── .gitignore
├── Makefile
├── README.md
└── Vagrantfile                # Defines VMs and networking
```

---

## ⚙️ What Ansible Automates

### ✅ Inventory
Ansible uses the `inventory.yml` file to define:
- `k3s_master`: The main control plane node
- `k3s_agents`: All worker nodes
- SSH connection details retrieved from Vagrant (`.vagrant/.../private_key`)

### ✅ Common Role
Applied to **all machines**, typically includes:
- Updating APT package index
- Installing dependencies (`curl`, `net-tools`, `make`, etc.)
- Loading the `.env` for token usage
- Any other global setup steps

### ✅ Master Role
Applied **only to the K3s master**, handles:
- Installing K3s server
- Writing `kubeconfig` to a shared path
- Fetching and storing the `node-token` for agents

### ✅ Agent Role
Applied **only to K3s agents**, handles:
- Installing K3s agent binary
- Reading token from shared `.env`
- Joining the cluster via master’s IP

---
